SELECT 
    DISTINCT ID,
    NAME,
    Email,
    USDF_76,
    USDF_77,
    MAX_TERM_FOR_POPULATIONS,
    STUDENT_POPULATION, 
    STUDENT_POPULATION_DESCRIPTION,
    ADM_POPULATION,
    ADMISSIONS_POPULATION_DESCRIPTION,
    PACKAGE_REQUIRE_COMPLETE_DATE, 
    PERIOD_BUDGET_GROUP_CODE, 
    
    CASE 
        WHEN RRRAREQ_TRST_CODE = 'SAPAF' THEN 'Y' 
        ELSE 'N' 
    END AS SAPAF,
    
    CASE
        WHEN FAFSA_IND IS NOT NULL THEN 'Y'
        ELSE 'N'
    END AS FAFSA_ON_FILE,
    
    STUDRS_TREQ,
    STUDRS_TREQ_STATUS,
    STUDS_TREQ,
    STUDS_TREQ_STATUS,
    
    STUDENT_TYPE_CODE, 
    STUDENT_TYPE_TERM_EFF, 
    STUDENT_TYPE_STATUS,
    
    CASE WHEN OIA_or_OGE IN ('OIA','OGE') THEN 'Y'
    ELSE 'N'
    END AS SUB_OIA_OGE,
    
    CURRENT_TIME_STATUS,
    SAP_TERM_CODE,
    SATISFACTORY_ACAD_PROG_CODE,
    
    CASE WHEN SCH_OR_GRTS_OFFD > 0 THEN 'Y'
    ELSE 'N'
    END AS Scholarships_or_Grants_Offered,
    
    Total_Aid_Offered,
    Residency,
    Aid_Period,
    COA
    
FROM 
(
    SELECT DISTINCT 
        SPRIDEN_PIDM, 
        SPRIDEN_ID AS ID, 
        SPRIDEN_LAST_NAME || ', ' || SPRIDEN_FIRST_NAME AS NAME, 
        ROBUSDF_VALUE_76 AS USDF_76,
        ROBUSDF_VALUE_77 AS USDF_77,
        
        GOREMAL_EMAIL_ADDRESS AS Email,
                
        (SELECT SUM(RBRAPBC_AMT)
        FROM RBRAPBC
        WHERE  RBRAPBC_PIDM = RORSTAT_PIDM
               AND RBRAPBC_AIDY_CODE = :AIDY
               AND RBRAPBC_RUN_NAME = 'ACTUAL'
               AND RBRAPBC_PBTP_CODE = 'COA'
               AND RBRAPBC_PERIOD IN (:SMR_TRM,:FAL_TRM,:SPR_TRM)) AS COA,
        
        (SELECT SARADAP_TERM_CODE_ENTRY
         FROM SARADAP
         WHERE SARADAP_PIDM = RORSTAT_PIDM
         AND SARADAP_APPL_NO  = (
         SELECT MAX(B.SARADAP_APPL_NO)
         FROM SARADAP B
         WHERE B.SARADAP_PIDM = RORSTAT_PIDM 
         AND RORSTAT_AIDY_CODE = :AIDY
        -- AND B.SARADAP_TERM_CODE_ENTRY IN (:SMR_TRM, :FAL_TRM, :SPR_TRM) 
         ) )AS MAX_TERM_FOR_POPULATIONS,
        
        SARADAP_STYP_CODE AS STUDENT_POPULATION, 
        STVSTYP_DESC AS STUDENT_POPULATION_DESCRIPTION, 
        SARADAP_ADMT_CODE AS ADM_POPULATION, 
        STVADMT_DESC AS ADMISSIONS_POPULATION_DESCRIPTION,
        RORSTAT_PCKG_COMP_DATE AS PACKAGE_REQUIRE_COMPLETE_DATE, 
        RBRAPBG_PBGP_CODE AS PERIOD_BUDGET_GROUP_CODE, 
        RRRAREQ_TRST_CODE,
        
        (SELECT RRRAREQ_TREQ_CODE
        FROM RRRAREQ
        WHERE RORSTAT_PIDM = RRRAREQ_PIDM
        AND RRRAREQ_AIDY_CODE = RORSTAT_AIDY_CODE
        AND RRRAREQ_TREQ_CODE = 'STUDRS')
        AS STUDRS_TREQ,
        
        (SELECT RRRAREQ_TRST_CODE
        FROM RRRAREQ
        WHERE RORSTAT_PIDM = RRRAREQ_PIDM
        AND RRRAREQ_AIDY_CODE = RORSTAT_AIDY_CODE
        AND RRRAREQ_TREQ_CODE = 'STUDRS')
        AS STUDRS_TREQ_STATUS,
        
        (SELECT RRRAREQ_TREQ_CODE
        FROM RRRAREQ
        WHERE RORSTAT_PIDM = RRRAREQ_PIDM
        AND RRRAREQ_AIDY_CODE = RORSTAT_AIDY_CODE
        AND RRRAREQ_PERIOD = :CUR_TRM
        AND RRRAREQ_TREQ_CODE IN ('STUDSA', 'STUDSF', 'STUDSN'))
        AS STUDS_TREQ,
        
        (SELECT RRRAREQ_TRST_CODE
        FROM RRRAREQ
        WHERE RORSTAT_PIDM = RRRAREQ_PIDM
        AND RRRAREQ_AIDY_CODE = RORSTAT_AIDY_CODE
        AND RRRAREQ_PERIOD = :CUR_TRM
        AND RRRAREQ_TREQ_CODE IN ('STUDSA', 'STUDSF', 'STUDSN'))
        AS STUDS_TREQ_STATUS,
        
        RORSTAT_APPL_RCVD_DATE AS FAFSA_IND,
        RORSTAT_APRD_CODE AS Aid_Period,
        
        (SELECT SGBSTDN_RESD_CODE
        FROM SGBSTDN 
        WHERE SGBSTDN_PIDM = RORSTAT_PIDM
                        AND SGBSTDN_STST_CODE = 'AS'
                        AND SGBSTDN_TERM_CODE_EFF = (
                            SELECT MAX(B.SGBSTDN_TERM_CODE_EFF)
                            FROM SGBSTDN B
                            WHERE B.SGBSTDN_PIDM = RORSTAT_PIDM
                              AND B.SGBSTDN_STST_CODE = 'AS'
                              AND B.SGBSTDN_TERM_CODE_EFF <= :SPR_TRM
                        ) ) AS Residency,
        
        (SELECT SGBSTDN_STYP_CODE
        FROM SGBSTDN
        WHERE SGBSTDN_PIDM = RORSTAT_PIDM
                        AND SGBSTDN_STYP_CODE IN ('G', 'W')
                        AND SGBSTDN_STST_CODE = 'AS'
                        AND SGBSTDN_TERM_CODE_EFF = (
                            SELECT MAX(F.SGBSTDN_TERM_CODE_EFF)
                            FROM SGBSTDN F
                            WHERE F.SGBSTDN_PIDM = RORSTAT_PIDM
                              AND F.SGBSTDN_STST_CODE = 'AS'
                              AND F.SGBSTDN_TERM_CODE_EFF <= :SPR_TRM
                        ) ) AS STUDENT_TYPE_CODE, 
                        
        (SELECT SGBSTDN_TERM_CODE_EFF
        FROM SGBSTDN
        WHERE SGBSTDN_PIDM = RORSTAT_PIDM
                        AND SGBSTDN_STST_CODE = 'AS'
                        AND SGBSTDN_TERM_CODE_EFF = (
                            SELECT MAX(D.SGBSTDN_TERM_CODE_EFF)
                            FROM SGBSTDN D
                            WHERE D.SGBSTDN_PIDM = RORSTAT_PIDM
                              AND D.SGBSTDN_STST_CODE = 'AS'
                              AND D.SGBSTDN_TERM_CODE_EFF <= :SPR_TRM
                        ) ) AS STUDENT_TYPE_TERM_EFF, 
                        
        (SELECT SGBSTDN_STST_CODE
        FROM SGBSTDN
        WHERE SGBSTDN_PIDM = RORSTAT_PIDM
                        AND SGBSTDN_STST_CODE = 'AS'
                        AND SGBSTDN_TERM_CODE_EFF = (
                            SELECT MAX(H.SGBSTDN_TERM_CODE_EFF)
                            FROM SGBSTDN H
                            WHERE H.SGBSTDN_PIDM = RORSTAT_PIDM
                              AND H.SGBSTDN_STST_CODE = 'AS'
                              AND H.SGBSTDN_TERM_CODE_EFF <= :SPR_TRM
                        ) ) STUDENT_TYPE_STATUS,
                        
        SFBETRM_ESTS_CODE     AS OIA_or_OGE,
        
        (SELECT (SFRTHST_TMST_CODE)
        FROM SFRTHST
        WHERE rownum = 1 
        AND SFRTHST_PIDM = RORSTAT_PIDM
        AND     SFRTHST_TERM_CODE = :CUR_TRM
        AND     SFRTHST_ACTIVITY_DATE =
                (SELECT MAX(SFRTHST_ACTIVITY_DATE)
                FROM SFRTHST Z
                WHERE Z.SFRTHST_PIDM = RORSTAT_PIDM
                AND   Z.SFRTHST_TERM_CODE = :CUR_TRM)) CURRENT_TIME_STATUS,
                
        (SELECT RORSAPR_SAPR_CODE
                FROM RORSAPR
                WHERE RORSAPR_PIDM = RORSTAT_PIDM 
                AND RORSAPR_TERM_CODE =
            (SELECT MAX (T.RORSAPR_TERM_CODE)
               FROM RORSAPR T
               WHERE T.RORSAPR_PIDM = RORSTAT_PIDM 
               AND T.RORSAPR_TERM_CODE <= :SPR_TRM)) SATISFACTORY_ACAD_PROG_CODE,
        
        (SELECT RORSAPR_TERM_CODE
        FROM RORSAPR
        WHERE RORSAPR_PIDM = RORSTAT_PIDM
        AND RORSAPR_TERM_CODE = (
        SELECT MAX(H.RORSAPR_TERM_CODE)
        FROM RORSAPR H
        WHERE H.RORSAPR_PIDM = RORSTAT_PIDM
        AND H.RORSAPR_TERM_CODE <= :SPR_TRM)
        ) AS SAP_TERM_CODE,
        
       (SELECT SUM(RPRAWRD_OFFER_AMT)
         FROM RPRAWRD
         WHERE RPRAWRD_PIDM = RORSTAT_PIDM
         AND RPRAWRD_FUND_CODE IN ('SI%', 'SP%','GI%')
         AND RPRAWRD_AIDY_CODE = RORSTAT_AIDY_CODE
         AND RPRAWRD_OFFER_AMT > 0 ) AS SCH_OR_GRTS_OFFD,
        
        (SELECT SUM(RPRAWRD_OFFER_AMT)
         FROM RPRAWRD
         WHERE RPRAWRD_PIDM = RORSTAT_PIDM
         AND RPRAWRD_AIDY_CODE = RORSTAT_AIDY_CODE
         AND RPRAWRD_OFFER_AMT > 0) AS Total_Aid_Offered
        
    FROM RORSTAT
    
    LEFT JOIN SPRIDEN 
    ON SPRIDEN_PIDM = RORSTAT_PIDM 
    AND SPRIDEN_CHANGE_IND IS NULL
   
    JOIN SARADAP 
    ON SARADAP_PIDM = RORSTAT_PIDM
    AND SARADAP_APPL_NO =
    (SELECT MAX(SARADAP_APPL_NO)
      FROM SARADAP C
       WHERE C.SARADAP_PIDM = RORSTAT_PIDM  
       AND RORSTAT_AIDY_CODE = :AIDY)
        -- AND C.SARADAP_TERM_CODE_ENTRY IN (:SMR_TRM, :FAL_TRM, :SPR_TRM))
    
    LEFT JOIN STVADMT 
    ON STVADMT_CODE = SARADAP_ADMT_CODE
    
    LEFT JOIN STVSTYP 
    ON SARADAP_STYP_CODE = STVSTYP_CODE
    
    LEFT JOIN SFBETRM
    ON SFBETRM_PIDM = RORSTAT_PIDM
        
    LEFT JOIN RBRAPBG
    ON RBRAPBG_PIDM = RORSTAT_PIDM
    AND RBRAPBG_AIDY_CODE = :AIDY
    AND RBRAPBG_PERIOD = :FAL_TRM
    
    LEFT JOIN RRRAREQ 
    ON RORSTAT_PIDM = RRRAREQ_PIDM
    
    LEFT JOIN ROBUSDF
    ON RORSTAT_PIDM = ROBUSDF_PIDM 
    AND ROBUSDF_AIDY_CODE = :AIDY  
    
    LEFT JOIN GOREMAL
        ON RORSTAT_PIDM = GOREMAL_PIDM
        AND GOREMAL_EMAL_CODE = 'U'
        AND GOREMAL_STATUS_IND = 'A'
        AND GOREMAL_PREFERRED_IND = 'Y'
       
    LEFT JOIN RCRAPP1 
    ON RORSTAT_PIDM = RCRAPP1_PIDM 
                        AND RORSTAT_AIDY_CODE = RCRAPP1_AIDY_CODE 
                        AND RCRAPP1_INFC_CODE = 'EDE' 
                        AND RCRAPP1_CURR_REC_IND = 'Y'
                        
    LEFT JOIN RCRAPP2 
    ON RCRAPP1_PIDM = RCRAPP2_PIDM
                        AND RCRAPP1_INFC_CODE = RCRAPP2_INFC_CODE
                        AND RCRAPP1_AIDY_CODE = RCRAPP2_AIDY_CODE
                        AND RCRAPP1_SEQ_NO = RCRAPP2_SEQ_NO

                        
  WHERE RORSTAT_AIDY_CODE = :AIDY
  AND SPRIDEN_ID IN ('811271615',
'811279106',
'811200419',
'811273213',
'811433631',
'811280696',
'811255842',
'811250777',
'811266180',
'811264894',
'811259257',
'811257618',
'811269579',
'811270900',
'811255846',
'811284575',
'811267813',
'811110252',
'811265294',
'811266310',
'811242393',
'811262207',
'811280262',
'811281137',
'811282358',
'811265719',
'811261512',
'811193999',
'811252422',
'811274872',
'811274875',
'811197694',
'811285824',
'811314958',
'811257190',
'811232279',
'811265191',
'811252426',
'811228442',
'811384023',
'811252325',
'811285856',
'811279572',
'811253486',
'811206565',
'811326680',
'811100249',
'811433568',
'811270621',
'811272248',
'811273722',
'811265002',
'811282090',
'811282261',
'811219670',
'811106894',
'811272308',
'811426557',
'811269272',
'811273791',
'811250646',
'811267114',
'811267129',
'811318269',
'811264520',
'811275928',
'811253968',
'811267267',
'811264561',
'811235301',
'811273924',
'811257523',
'811202725',
'811280435',
'811116976',
'811275224',
'811310697',
'811257789',
'811267378',
'811252464',
'811267438',
'811306166',
'811255650',
'811296604',
'811276580',
'811280482',
'811262945',
'811250867',
'811254190',
'811153080',
'811271383',
'811270747',
'811197901',
'811303341',
'811261652',
'811283050',
'811263617',
'811254083',
'811270766',
'810529003',
'811250886',
'811284736',
'811171142',
'811318780',
'811282885',
'810637243',
'811279812',
'811200424',
'811281953',
'811213914',
'811128749',
'811335408',
'811196894',
'811210714',
'811283146',
'811253755',
'811262214',
'811263445',
'811270981',
'811126917',
'811266501',
'811258192',
'810004109',
'811264355',
'811351024',
'811417652',
'811274996',
'811250813',
'811310857',
'811222497',
'811275867',
'811273726',
'811280385',
'811270646',
'811368662',
'811009306',
'811302717',
'811264595',
'811333837',
'811262646',
'811254040',
'811279201',
'811275335',
'811239529',
'811205482',
'811236720',
'811265138',
'811134618',
'811270761',
'811267823',
'811279717'

)

)
 ORDER BY 1
 
